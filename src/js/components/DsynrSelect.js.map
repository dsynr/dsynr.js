{"version":3,"file":"DsynrSelect.js","sourceRoot":"","sources":["../../ts/components/DsynrSelect.ts"],"names":[],"mappings":"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","sourcesContent":["class DsynrSelect extends DsynrUIIElement {\r\n\r\n    content: HTMLSelectElement;\r\n    private trigger: HTMLElement;\r\n    private esPrevOpt: HTMLElement;\r\n\r\n    private options: HTMLOptionsCollection;\r\n    private option: HTMLOptionElement;\r\n\r\n    private adoptParent: boolean;\r\n    private showFinder: boolean;\r\n    private autoExit: boolean;\r\n    private isActive: boolean;\r\n\r\n    private triggerCls: string;\r\n    private optCls: string;\r\n    private optClsActive: string;\r\n    private optionPrefix: string;\r\n\r\n    private modal: DsynrModal;\r\n    private modalPref: object;\r\n\r\n    constructor(select: HTMLElement, preferences: object = {}) {\r\n        super(select, preferences);\r\n        if (!this.selfAbort) {\r\n            d.lfn('DsynrSelect');\r\n            this.setDefaults();\r\n            this.setup();\r\n        }\r\n    }\r\n\r\n    setDefaults(reset: boolean = false): void {\r\n\r\n        super.setDefaults();\r\n\r\n        d.lfn('setDefaults');\r\n\r\n        this.adoptParent = d.addProp(this, 'adoptParent', true, reset);\r\n        this.nameSuffix = d.addProp(this, 'nameSuffix', DsynrSelect.instances.length.toString(), reset);\r\n        this.namePrefix = d.addProp(this, 'namePrefix', 'dsynrEnhancedSelect', reset);\r\n        this.optionPrefix = d.addProp(this, 'namePrefix', d.concatStr([this.namePrefix, 'option'], '-'), reset);\r\n        this.instanceClass = d.addProp(this, 'instanceClasses', d.concatStr([this.namePrefix, 'rounded bg-light shadow p-5']), reset);\r\n        this.showFinder = d.addProp(this, 'showFinder', false, reset);\r\n        this.autoExit = d.addProp(this, 'autoExit', true, reset);\r\n        this.isActive = d.addProp(this, 'isActive', false, reset);\r\n        this.triggerCls = d.addProp(this, 'btnCls', d.concatStr([this.namePrefix, 'trigger btn btn-link'], '-'), reset);\r\n        this.optCls = d.addProp(this, 'optCls', d.concatStr([this.optionPrefix, 'hand p-2']), reset);\r\n        this.optClsActive = d.addProp(this, 'optClsActive', 'active bg-warning rounded', reset);\r\n    }\r\n\r\n    setup(): void {\r\n        d.lfn('setup');\r\n        if (this.content.id === '') {\r\n            this.content.id = 'dsynrSelect-' + DsynrSelect.instances.length;\r\n        }\r\n        this.options = this.content.options;\r\n        this.option = this.options[this.options.selectedIndex];\r\n        this.setTrigger();\r\n        console.log('Select Trigger READY!');\r\n    }\r\n\r\n    show(): void {\r\n        d.lfn('show triggered via : ' + this.trigger.id);\r\n        if (this.isActive) {\r\n            this.attention();\r\n        } else {\r\n            this.instance = d.addDiv(this.setName('', this.content.id), this.instanceClass);\r\n            this.instance.tabIndex = 0;\r\n            this.instance.style.outline = 'none';\r\n            let ths: DsynrSelect = this;\r\n            d.makeArray(this.options).forEach(function (o: HTMLOptionElement, index: number) {\r\n                ths.addESOption(o, index);\r\n            });\r\n            this.modalPref = d.mergeObjs(this.preferences, {\r\n                'trigger': 'auto', 'parent': this.parent, 'adoptParent': this.adoptParent, 'onModalDestroy': () => {\r\n                    ths.destroy();\r\n                }\r\n            });\r\n            this.modal = new DsynrModal(this.instance, this.modalPref);\r\n            this.setActive();\r\n        }\r\n    }\r\n\r\n    attention(): void {\r\n        DsynrSelect.activeInstance = this;\r\n        this.modal.attention();\r\n    }\r\n\r\n    private update(selectOption: HTMLOptionElement): void {\r\n        d.lfn('update');\r\n        d.removeClass(this.esPrevOpt, this.optClsActive);\r\n        this.option = selectOption;\r\n        d.addClass(this.option, this.optClsActive);\r\n        this.esPrevOpt = d.getElementById(selectOption.id);\r\n        this.content.selectedIndex = parseInt(d.getData(selectOption, 'index'));\r\n        this.trigger.textContent = this.option.innerText;\r\n        if (this.autoExit) {\r\n            this.destroy();\r\n        }\r\n    }\r\n\r\n    private addESOption(o: HTMLOptionElement, i: number): void {\r\n        d.lfn('addESOption');\r\n        let oid: string = d.concatStr([this.optionPrefix, this.content.id, i], '-');\r\n        let ocls: string;\r\n        console.log(this.esPrevOpt);\r\n        ocls = (i == this.content.selectedIndex) ? d.concatStr([this.optCls, this.optClsActive]) : ocls = this.optCls;\r\n\r\n        let eso: HTMLElement = d.addDiv(oid, ocls, this.instance);\r\n        eso.tabIndex = i;\r\n        eso.style.outline = 'none';\r\n        if (i == this.option.index) {\r\n            this.esPrevOpt = eso;\r\n        }\r\n        let oe: HTMLOptionElement = <HTMLOptionElement>d.getElementById(oid);\r\n        oe.textContent = o.text;\r\n        d.setData(oe, 'index', o.index.toString());\r\n\r\n        let ths: DsynrSelect = this;\r\n        d.addListener(oe.id, 'click', function () {\r\n            d.lclk(oe.id);\r\n            ths.update(oe);\r\n        });\r\n        d.addListener(oe.id, 'keydown', function (ev) {\r\n            if (ev.key == 'Enter') {\r\n                ths.update(oe);\r\n            }\r\n        });\r\n    }\r\n\r\n    private setTrigger(): void {\r\n        d.lfn('addTrigger');\r\n        this.trigger = d.addDiv(this.setName('btn', this.content.id), this.triggerCls, <HTMLElement>this.content.parentElement);\r\n        d.addText(this.option.text, this.trigger);\r\n        let ths: DsynrSelect = this;\r\n        d.addListener(this.trigger.id, 'click', function (ev) {\r\n            ev.preventDefault();\r\n            ths.show();\r\n        });\r\n        d.hide(this.content);\r\n    }\r\n\r\n    protected addListeners() {\r\n        d.lfn('d.addListeners...');\r\n        let ths: DsynrSelect = this;\r\n        d.addListener(this.instance.id, 'focus', ev => {\r\n            console.log('focused!');\r\n        });\r\n        d.addListener(this.instance.id, 'keydown', function (evnt: KeyboardEvent) {\r\n            switch (evnt.key) {\r\n                case 'ArrowDown':\r\n                case 'ArrowRight':\r\n                case 'Tab':\r\n                    ths.next();\r\n                    break;\r\n                case 'ArrowUp':\r\n                case 'ArrowLeft':\r\n                    ths.prev();\r\n                    break;\r\n                case 'Escape':\r\n                    ths.destroy();\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n\r\n    private next(): void {\r\n        d.lfn('next');\r\n    }\r\n\r\n    private prev(): void {\r\n        d.lfn('prev');\r\n    }\r\n\r\n    destroy() {\r\n        d.lfn('destroy');\r\n        this.modal.hide(true);\r\n        this.isActive = false;\r\n        DsynrSelect.activeInstance = false;\r\n    }\r\n\r\n    protected setActive(): void {\r\n        d.lfn('setActive');\r\n        this.isActive = true;\r\n        DsynrSelect.activeInstance = this;\r\n        this.addListeners();\r\n        this.instance.focus();\r\n    }\r\n\r\n    static auto(selectClass: string = 'dsynrSelect'): void {\r\n        d.lfn('auto');\r\n        d.makeArray(d.getElementsByClass(selectClass)).forEach(function (instance) {\r\n            new DsynrSelect(instance);\r\n        });\r\n    }\r\n}"]}